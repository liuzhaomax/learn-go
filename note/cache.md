# 缓存
redis mongodb 雪崩 穿透 击穿 布隆过滤器 多级缓存架构
红锁Redlock

> https://www.bilibili.com/video/BV14x421k7hJ/?spm_id_from=333.999.0.0&vd_source=7c58b2999811337c63c69bda6933f026

> https://www.bilibili.com/video/BV1Fd4y1T7pD/?spm_id_from=333.999.0.0&vd_source=7c58b2999811337c63c69bda6933f026

> https://www.bilibili.com/video/BV1df421S7bZ/?spm_id_from=333.999.0.0&vd_source=7c58b2999811337c63c69bda6933f026

> https://www.bilibili.com/video/BV1KS421K78d/?spm_id_from=333.999.0.0&vd_source=7c58b2999811337c63c69bda6933f026

## 1. 数据类型

+ String：Redis 中最基本的数据类型，可以是任何类型的字符串，如文本或二进制数据（如图片）。
+ Hash：类似于一个具有键值对的字典，特别适合用于存储对象。
+ List：一个按插入顺序排序的字符串列表，可以添加到列表的头部或尾部。
+ Set：一个无序的字符串集合，集合成员是唯一的（不能重复）
+ ZSet（有序集合）：类似于 Set，但每个成员都会关联一个分数，Redis 会根据分数自动排序。
+ Bitmap（位图）：使用字符串存储位值（0 或 1），可以对其进行位操作。
+ HyperLogLog：一种用于基数估算的数据结构，适合用于大数据去重计数，且占用空间非常小。
+ Geo（地理位置）：用于存储地理位置信息并执行地理位置操作。
+ Stream（流）：用于处理消息流的高级数据类型，类似于消息队列。
+ Pub/Sub（发布/订阅）：虽然严格来说不是一种数据类型，但它是一种消息传递模式，允许发送者发布消息，接收者订阅消息。

## 2. 缓存的使用
延迟双删

## 3. 失效情况

1. 缓存雪崩

定义：

缓存雪崩指的是在同一时间大量缓存集中失效，从而导致大量请求直接打到数据库上，可能造成数据库短时间内承受不了巨大的流量，进而崩溃。

原因：
+ 大量缓存设置了相同的过期时间，导致在同一时间失效。
+ 缓存服务器宕机或重启，所有缓存数据丢失。

应对措施：
+ 给缓存设置随机过期时间，避免同一时间大批量缓存失效。例如，可以在原有的过期时间基础上增加一个随机数。
+ 使用多级缓存，将热点数据缓存在不同的层次上，减少单一层次失效的影响。
+ 设置缓存预热机制，提前加载热点数据。

2. 缓存击穿

定义：

缓存击穿指的是缓存中没有但数据库中有的数据，因为这些数据是热点数据，当这些数据请求未命中缓存时，会引发大量请求直接打到数据库上。

原因：
+ 热点数据过期后，大量并发请求直接访问数据库，造成数据库压力增大。

应对措施：
+ 使用互斥锁（如 Redis 分布式锁）或分布式锁来控制并发请求，避免大量并发请求同时去查询数据库并回写缓存。
+ 永不过期：对于热点数据，可以设置缓存不过期，或者采用逻辑过期，在后台线程中定期刷新缓存。

3. 缓存穿透

定义：

缓存穿透指的是查询一个根本不存在的数据，由于缓存中没有该数据的缓存（通常设计为不存在的数据不缓存），因此每次请求都会直接打到数据库上，可能导致数据库压力过大。

原因：
+ 恶意请求查询不存在的数据。
+ 开发人员失误查询了大量不存在的数据。

应对措施：
+ 对查询结果为空的数据进行缓存，设置一个较短的过期时间。例如，缓存一个空值（如 Null 或特殊标记），避免频繁查询数据库。
+ 使用布隆过滤器（Bloom Filter）在应用层进行预过滤，拦截掉那些肯定不存在的请求。
+ 通过理解和应对这些缓存问题，可以显著提升系统的稳定性和性能，避免缓存失效对数据库造成的冲击。

